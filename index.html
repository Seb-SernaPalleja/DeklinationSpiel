<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deklinator Pro v4 - International</title>
    <script type="text/javascript" src="data.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .verb-highlight { 
            border-bottom: 2px dotted #64748b; 
            cursor: help; 
            transition: all 0.2s;
        }
        .verb-highlight:hover { 
            color: #2563eb; 
            border-color: #2563eb; 
            background-color: #eff6ff;
        }

        .slot-filled { cursor: pointer; }
        .slot-filled:hover { text-decoration: line-through; color: #ef4444; }
        
        /* Flags for language selector */
        .flag-icon { font-size: 1.2rem; margin-right: 0.5rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- SISTEMA DE TRADUCCI√ìN ---
        const UI_TEXTS = {
            es: {
                title: "Deklinator Pro",
                subtitle: "Entrenador de gram√°tica alemana",
                level: "Nivel Objetivo",
                cases: "Casos",
                customization: "Personalizaci√≥n",
                optAdjectives: "Incluir Adjetivos",
                optGender: "Pistas de G√©nero",
                optTags: "Mostrar Etiquetas",
                start: "Empezar Entrenamiento",
                correct: "Correctas",
                incorrect: "Fallos",
                noun: "Sustantivo(s)",
                selectArt: "Selecciona: Art√≠culo",
                selectAdj: "Selecciona: Adjetivo",
                check: "Comprobar Respuesta",
                next: "Siguiente Frase",
                excellent: "¬°Excelente!",
                wrong: "Incorrecto",
                correctAnswer: "Respuesta correcta:",
                tip: "Tip: Haz clic en el verbo para ver su significado.",
                summary: "Resumen",
                sessionEnd: "Sesi√≥n finalizada",
                improvement: "√Årea de mejora:",
                perfect: "¬°Sesi√≥n perfecta! Sin errores.",
                back: "Volver al Men√∫",
                finishSession: "Terminar sesi√≥n",
                verbInfo: "Informaci√≥n del Verbo",
                congratsTitle: "¬°Felicidades!",
                congratsMsg: "Has completado todas las frases disponibles para esta configuraci√≥n.",
                noQuestions: "No hay preguntas con esta configuraci√≥n. Intenta activar 'Adjetivos' o seleccionar m√°s casos."
            },
            en: {
                title: "Deklinator Pro",
                subtitle: "German Grammar Trainer",
                level: "Target Level",
                cases: "Cases",
                customization: "Customization",
                optAdjectives: "Include Adjectives",
                optGender: "Show Gender Hints",
                optTags: "Show Tags",
                start: "Start Training",
                correct: "Correct",
                incorrect: "Wrong",
                noun: "Noun(s)",
                selectArt: "Select: Article",
                selectAdj: "Select: Adjective",
                check: "Check Answer",
                next: "Next Sentence",
                excellent: "Excellent!",
                wrong: "Incorrect",
                correctAnswer: "Correct answer:",
                tip: "Tip: Click on the verb to see its meaning.",
                summary: "Summary",
                sessionEnd: "Session Finished",
                improvement: "Needs Improvement:",
                perfect: "Perfect session! No mistakes.",
                back: "Back to Menu",
                finishSession: "End Session",
                verbInfo: "Verb Information",
                congratsTitle: "Congratulations!",
                congratsMsg: "You have completed all available sentences for this configuration.",
                noQuestions: "No questions found. Try enabling 'Adjectives' or selecting more cases."
            },
            tr: {
                title: "Deklinator Pro",
                subtitle: "Almanca Dilbilgisi Eƒüitmeni",
                level: "Hedef Seviye",
                cases: "Durumlar",
                customization: "√ñzelle≈ütirme",
                optAdjectives: "Sƒ±fatlarƒ± Dahil Et",
                optGender: "Cinsiyet ƒ∞pu√ßlarƒ±",
                optTags: "Etiketleri G√∂ster",
                start: "Eƒüitime Ba≈üla",
                correct: "Doƒüru",
                incorrect: "Yanlƒ±≈ü",
                noun: "ƒ∞sim(ler)",
                selectArt: "Se√ß: Artikel",
                selectAdj: "Se√ß: Sƒ±fat",
                check: "Cevabƒ± Kontrol Et",
                next: "Sonraki C√ºmle",
                excellent: "M√ºkemmel!",
                wrong: "Yanlƒ±≈ü",
                correctAnswer: "Doƒüru cevap:",
                tip: "ƒ∞pucu: Anlamƒ±nƒ± g√∂rmek i√ßin fiile tƒ±klayƒ±n.",
                summary: "√ñzet",
                sessionEnd: "Oturum Bitti",
                improvement: "Geli≈ütirilmesi Gereken:",
                perfect: "M√ºkemmel oturum! Hata yok.",
                back: "Men√ºye D√∂n",
                finishSession: "Oturumu Bitir",
                verbInfo: "Fiil Bilgisi",
                congratsTitle: "Tebrikler!",
                congratsMsg: "Bu yapƒ±landƒ±rma i√ßin mevcut t√ºm c√ºmleleri tamamladƒ±nƒ±z.",
                noQuestions: "Bu ayarlara uygun soru bulunamadƒ±. 'Sƒ±fatlarƒ±' a√ßmayƒ± veya daha fazla durum se√ßmeyi deneyin."
            },
            de: {
                title: "Deklinator Pro",
                subtitle: "Deutsche Grammatik Trainer",
                level: "Zielniveau",
                cases: "F√§lle",
                customization: "Anpassung",
                optAdjectives: "Adjektive einbeziehen",
                optGender: "Genus-Hinweise",
                optTags: "Tags anzeigen",
                start: "Training starten",
                correct: "Richtig",
                incorrect: "Falsch",
                noun: "Nomen",
                selectArt: "W√§hle: Artikel",
                selectAdj: "W√§hle: Adjektiv",
                check: "√úberpr√ºfen",
                next: "N√§chster Satz",
                excellent: "Ausgezeichnet!",
                wrong: "Falsch",
                correctAnswer: "Richtige Antwort:",
                tip: "Tipp: Klicke auf das Verb f√ºr mehr Infos.",
                summary: "Zusammenfassung",
                sessionEnd: "Sitzung beendet",
                improvement: "Verbesserungsw√ºrdig:",
                perfect: "Perfekte Sitzung! Keine Fehler.",
                back: "Zur√ºck zum Men√º",
                finishSession: "Sitzung beenden",
                verbInfo: "Verb-Information",
                congratsTitle: "Gl√ºckwunsch!",
                congratsMsg: "Du hast alle verf√ºgbaren S√§tze f√ºr diese Konfiguration abgeschlossen.",
                noQuestions: "Keine Fragen gefunden. Versuche Adjektive zu aktivieren."
            }
        };

        // --- BASE DE DATOS LOCALIZADA ---
        // Funci√≥n generadora para devolver los datos en el idioma correcto
        const getQuestionPool = (lang) => data;
        // --- COMPONENTES UI ---

        const Toggle = ({ label, checked, onChange }) => (
            <div className="flex items-center justify-between py-3 border-b border-slate-100 last:border-0">
                <span className="text-slate-700 font-medium text-sm">{label}</span>
                <button 
                    onClick={() => onChange(!checked)}
                    className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ease-in-out ${checked ? 'bg-blue-600' : 'bg-slate-300'}`}
                >
                    <div className={`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-300 ${checked ? 'translate-x-6' : 'translate-x-0'}`}></div>
                </button>
            </div>
        );

        const VerbModal = ({ info, onClose, title }) => (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm fade-in" onClick={onClose}>
                <div className="bg-white rounded-xl p-6 shadow-2xl max-w-sm w-full mx-4 transform transition-all scale-100" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-start mb-2">
                        <h3 className="text-lg font-bold text-slate-800">{title}</h3>
                        <button onClick={onClose} className="text-slate-400 hover:text-slate-600"><i className="fas fa-times"></i></button>
                    </div>
                    <p className="text-blue-600 font-serif text-xl italic mb-3">{info.word}</p>
                    <p className="text-slate-600 leading-relaxed text-sm">{info.desc}</p>
                </div>
            </div>
        );

        const LanguageSelector = ({ current, onChange }) => (
            <div className="flex justify-center space-x-4 mb-6">
                {[
                    { code: 'es', label: 'üá™üá∏ ES' },
                    { code: 'en', label: 'üá¨üáß EN' },
                    { code: 'tr', label: 'üáπüá∑ TR' },
                    { code: 'de', label: 'üá©üá™ DE' }
                ].map(lang => (
                    <button
                        key={lang.code}
                        onClick={() => onChange(lang.code)}
                        className={`px-3 py-1 rounded-full text-sm font-bold transition-all ${
                            current === lang.code 
                            ? 'bg-blue-600 text-white shadow-md' 
                            : 'bg-white text-slate-500 hover:bg-slate-100'
                        }`}
                    >
                        {lang.label}
                    </button>
                ))}
            </div>
        );

        const App = () => {
            // --- ESTADO ---
            const [view, setView] = useState('config'); // config, playing, summary, congrats
            const [lang, setLang] = useState('es'); // Idioma actual
            const T = UI_TEXTS[lang]; // Shortcut para textos

            // Configuraci√≥n
            const [config, setConfig] = useState({
                level: 'B2',
                cases: { Akk: true, Dat: true, Gen: true, Nom: true },
                showGenderHint: false,
                showTags: false,
                includeAdjectives: true
            });

            // Juego
            const [score, setScore] = useState({ correct: 0, incorrect: 0 });
            
            // NEW: Stack de preguntas pendientes (IDs o objetos completos)
            const [questionStack, setQuestionStack] = useState([]);
            const [currentQ, setCurrentQ] = useState(null);
            
            const [userSelections, setUserSelections] = useState([]); 
            const [feedback, setFeedback] = useState(null); 
            const [verbModalData, setVerbModalData] = useState(null); 
            const [mistakeTracker, setMistakeTracker] = useState({}); 

            // --- L√ìGICA ---

            // Obtener preguntas filtradas en el idioma actual
            const getInitialStack = () => {
                const rawPool = getQuestionPool(lang);
                const negatedCases = Object.entries(config.cases)
                                              .filter(([_, value]) => value === false)
                                              .map(([key]) => key);
                return rawPool.filter(q => {
                    
                    if (negatedCases.some(caseBanned => q.includes(caseBanned))) return false;
                    const levels = ['B1', 'B2', 'C1', 'C2'];
                    const qLvlIdx = levels.indexOf(q.level);
                    const cfgLvlIdx = levels.indexOf(config.level);
                    if (Math.abs(qLvlIdx - cfgLvlIdx) > 1 && qLvlIdx > cfgLvlIdx) return false; 
                    const hasAdjSlot = q.slots.some(s => s.type === 'adj');
                    if (!config.includeAdjectives && hasAdjSlot) return false;
                    return true;
                });
            };

            const startGame = () => {
                const stack = getInitialStack();
                if (stack.length === 0) {
                    alert(T.noQuestions);
                    return;
                }
                setScore({ correct: 0, incorrect: 0 });
                setMistakeTracker({});
                setQuestionStack(stack); // Guardamos todas las preguntas posibles
                pickNextQuestion(stack); // Seleccionamos la primera
                setView('playing');
            };

            const pickNextQuestion = (currentStack) => {
                if (currentStack.length === 0) {
                    setView('congrats');
                    return;
                }
                // Seleccionar aleatoria del stack
                const randomIndex = Math.floor(Math.random() * currentStack.length);
                const nextQ = currentStack[randomIndex];
                
                setCurrentQ(nextQ);
                setUserSelections(new Array(nextQ.slots.length).fill(null)); 
                setFeedback(null);
            };

            const handleSlotClick = (slotIndex, option) => {
                if (feedback) return; 
                const newSelections = [...userSelections];
                newSelections[slotIndex] = option;
                for (let i = slotIndex + 1; i < newSelections.length; i++) {
                    newSelections[i] = null;
                }
                setUserSelections(newSelections);
            };

            const resetFromSlot = (slotIndex) => {
                if (feedback) return;
                const newSelections = [...userSelections];
                for (let i = slotIndex; i < newSelections.length; i++) {
                    newSelections[i] = null;
                }
                setUserSelections(newSelections);
            };

            const checkAnswer = () => {
                const isCorrect = userSelections.every((sel, idx) => sel === currentQ.slots[idx].answer);
                
                if (isCorrect) {
                    setScore(prev => ({ ...prev, correct: prev.correct + 1 }));
                    setFeedback('correct');
                    
                    // L√ìGICA CLAVE: Eliminar la pregunta acertada del stack
                    const newStack = questionStack.filter(q => q.id !== currentQ.id);
                    setQuestionStack(newStack);

                } else {
                    setScore(prev => ({ ...prev, incorrect: prev.incorrect + 1 }));
                    setFeedback('incorrect');
                    // NO eliminamos del stack, se repetir√° eventualmente
                    setMistakeTracker(prev => ({
                        ...prev,
                        [currentQ.category]: (prev[currentQ.category] || 0) + 1
                    }));
                }
            };

            const handleNextButton = () => {
                // Si fue correcta, questionStack ya fue actualizado.
                // Si fue incorrecta, questionStack sigue igual.
                // pickNextQuestion usa el stack actual.
                pickNextQuestion(questionStack);
            };

            // --- RENDERIZADORES ---

            const TextRenderer = () => {
                const elements = [];
                let slotCounter = 0;
                const tokenRegex = /({.*?}|___)/g;
                const tokens = currentQ.text.split(tokenRegex);

                tokens.forEach((token, idx) => {
                    if (token === '___') {
                        const slotIdx = slotCounter++;
                        const selection = userSelections[slotIdx];
                        const isCurrent = (selection === null && (slotIdx === 0 || userSelections[slotIdx - 1] !== null));
                        const isFilled = selection !== null;
                        
                        elements.push(
                            <span 
                                key={`slot-${slotIdx}`}
                                onClick={() => isFilled && resetFromSlot(slotIdx)}
                                className={`inline-block mx-1 min-w-[80px] px-2 text-center rounded transition-all border-b-2 cursor-pointer 
                                    ${feedback 
                                        ? (selection === currentQ.slots[slotIdx].answer ? 'text-green-600 border-green-400 bg-green-50' : 'text-red-500 border-red-400 bg-red-50 line-through') 
                                        : (isFilled 
                                            ? 'text-blue-600 border-blue-500 hover:text-red-400 hover:border-red-400 slot-filled' 
                                            : (isCurrent ? 'bg-blue-50 border-blue-300 animate-pulse' : 'border-slate-200 text-slate-300'))
                                    }`}
                            >
                                {selection || (feedback && currentQ.slots[slotIdx].answer) || "____"}
                            </span>
                        );
                    } else if (token.startsWith('{') && token.endsWith('}')) {
                        const verb = token.slice(1, -1);
                        elements.push(
                            <span 
                                key={`verb-${idx}`}
                                onClick={() => setVerbModalData({ word: verb, desc: currentQ.verbDesc[lang] })}
                                className="verb-highlight mx-1 text-slate-900"
                            >
                                {verb}
                            </span>
                        );
                    } else {
                        if (token) elements.push(<span key={`txt-${idx}`}>{token}</span>);
                    }
                });

                return <div className="text-2xl md:text-3xl text-center leading-loose font-medium text-slate-800 mb-8">{elements}</div>;
            };

            // --- VISTAS ---

            if (view === 'config') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-slate-50">
                        <div className="bg-white rounded-3xl shadow-xl w-full max-w-md overflow-hidden relative">
                            <div className="bg-slate-900 p-8 text-center pb-12">
                                <h1 className="text-3xl font-extrabold text-white tracking-tight">Deklinator <span className="text-blue-400">Pro</span></h1>
                                <p className="text-slate-400 text-sm mt-2">{T.subtitle}</p>
                            </div>

                            <div className="relative -mt-6 px-6">
                                <div className="bg-white rounded-xl shadow-lg p-2 border border-slate-100">
                                    <LanguageSelector current={lang} onChange={setLang} />
                                </div>
                            </div>

                            <div className="p-8 space-y-6 pt-2">
                                {/* Nivel */}
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 block">{T.level}</label>
                                    <div className="flex bg-slate-100 rounded-xl p-1">
                                        {['B1', 'B2', 'C1', 'C2'].map(lvl => (
                                            <button 
                                                key={lvl}
                                                onClick={() => setConfig({...config, level: lvl})}
                                                className={`flex-1 py-2 text-sm font-bold rounded-lg transition-all ${
                                                    config.level === lvl 
                                                    ? 'bg-white text-blue-600 shadow-sm' 
                                                    : 'text-slate-500 hover:text-slate-700'
                                                }`}
                                            >
                                                {lvl}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Casos */}
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 block">{T.cases}</label>
                                    <div className="flex gap-2">
                                        {['Akk', 'Dat', 'Gen'].map(c => (
                                            <button 
                                                key={c}
                                                onClick={() => setConfig(prev => ({ ...prev, cases: { ...prev.cases, [c]: !prev.cases[c] } }))}
                                                className={`flex-1 py-2 border-2 rounded-xl font-bold text-sm transition-all ${
                                                    config.cases[c] 
                                                    ? 'border-blue-500 bg-blue-50 text-blue-700' 
                                                    : 'border-slate-200 text-slate-400 hover:border-slate-300'
                                                }`}
                                            >
                                                {c}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Opciones Avanzadas */}
                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">{T.customization}</label>
                                    <Toggle 
                                        label={T.optAdjectives} 
                                        checked={config.includeAdjectives} 
                                        onChange={v => setConfig({...config, includeAdjectives: v})} 
                                    />
                                    <Toggle 
                                        label={T.optGender} 
                                        checked={config.showGenderHint} 
                                        onChange={v => setConfig({...config, showGenderHint: v})} 
                                    />
                                    <Toggle 
                                        label={T.optTags} 
                                        checked={config.showTags} 
                                        onChange={v => setConfig({...config, showTags: v})} 
                                    />
                                </div>

                                <button 
                                    onClick={startGame}
                                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95"
                                >
                                    {T.start}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'congrats') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-slate-50">
                        <div className="text-center max-w-lg w-full fade-in bg-white p-8 rounded-3xl shadow-2xl">
                            <div className="mb-8">
                                <div className="inline-flex items-center justify-center w-28 h-28 rounded-full bg-yellow-100 text-yellow-500 text-6xl mb-6 shadow-xl animate-bounce">
                                    üåü
                                </div>
                                <h2 className="text-4xl font-extrabold text-slate-800 mb-2">{T.congratsTitle}</h2>
                                <p className="text-slate-500 text-lg leading-relaxed">{T.congratsMsg}</p>
                            </div>
                            
                            <div className="bg-slate-50 rounded-xl p-6 mb-8 border border-slate-100">
                                <p className="text-sm font-bold text-slate-400 uppercase mb-2">{T.correct}</p>
                                <p className="text-4xl font-black text-green-600">{score.correct}</p>
                            </div>

                            <button onClick={() => setView('summary')} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition">
                                {T.summary}
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'summary') {
                const total = score.correct + score.incorrect;
                const percentage = total === 0 ? 0 : Math.round((score.correct / total) * 100);
                const mostMistakes = Object.entries(mistakeTracker).sort((a,b) => b[1] - a[1])[0];

                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-white">
                        <div className="text-center max-w-lg w-full fade-in">
                            <div className="mb-8">
                                <div className={`inline-flex items-center justify-center w-24 h-24 rounded-full text-5xl mb-4 shadow-xl ${percentage >= 80 ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}`}>
                                    {percentage >= 80 ? 'üèÜ' : 'üéì'}
                                </div>
                                <h2 className="text-4xl font-extrabold text-slate-800">{T.summary}</h2>
                                <p className="text-slate-500">{T.sessionEnd}</p>
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                    <p className="text-3xl font-bold text-slate-800">{score.correct}</p>
                                    <p className="text-xs font-bold text-slate-400 uppercase">{T.correct}</p>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                    <p className="text-3xl font-bold text-slate-800">{score.incorrect}</p>
                                    <p className="text-xs font-bold text-slate-400 uppercase">{T.incorrect}</p>
                                </div>
                            </div>

                            {mostMistakes ? (
                                <div className="bg-orange-50 border border-orange-100 p-4 rounded-xl text-left mb-8 flex items-start">
                                    <i className="fas fa-exclamation-triangle text-orange-400 mt-1 mr-3"></i>
                                    <div>
                                        <p className="text-orange-800 font-bold text-sm">{T.improvement}</p>
                                        <p className="text-orange-900 font-bold text-lg mt-1">{mostMistakes[0]}</p>
                                        <p className="text-orange-700 text-xs mt-1">{mostMistakes[1]} {T.incorrect.toLowerCase()}.</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="bg-green-50 border border-green-100 p-4 rounded-xl mb-8">
                                    <p className="text-green-800 font-bold">{T.perfect}</p>
                                </div>
                            )}

                            <button onClick={() => setView('config')} className="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg transition">
                                {T.back}
                            </button>
                        </div>
                    </div>
                );
            }

            if (view === 'playing' && currentQ) {
                const activeSlotIndex = userSelections.findIndex(s => s === null);
                const isFinished = activeSlotIndex === -1;
                const activeSlot = isFinished ? null : currentQ.slots[activeSlotIndex];

                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 max-w-3xl mx-auto pb-20">
                        
                        {verbModalData && <VerbModal info={verbModalData} title={T.verbInfo} onClose={() => setVerbModalData(null)} />}

                        {/* Top Bar */}
                        <div className="w-full flex justify-between items-center mb-6">
                            <div className="flex gap-4 text-sm font-bold">
                                <span className="text-green-600 bg-green-50 px-3 py-1 rounded-lg">{T.correct}: {score.correct}</span>
                                <span className="text-red-500 bg-red-50 px-3 py-1 rounded-lg">{T.incorrect}: {score.incorrect}</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-md">
                                    Remaining: {questionStack.length}
                                </span>
                                <button onClick={() => setView('summary')} className="text-slate-500 hover:text-red-600 text-xs font-bold underline decoration-dotted">
                                    {T.finishSession}
                                </button>
                            </div>
                        </div>

                        {/* Card Principal */}
                        <div className="bg-white rounded-3xl shadow-xl border border-slate-100 w-full overflow-hidden flex flex-col relative min-h-[400px]">
                            
                            {/* Etiquetas */}
                            {config.showTags && (
                                <div className="bg-slate-50 px-6 py-3 border-b border-slate-100 flex gap-2">
                                    <span className="text-xs font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded">{currentQ.level} ‚Ä¢ {currentQ.case}</span>
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-wide py-1">{currentQ.category}</span>
                                </div>
                            )}

                            <div className="p-8 flex-grow flex flex-col items-center justify-center">
                                {/* Pista Sustantivo */}
                                <div className="mb-6 text-center">
                                    <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">{T.noun}</span>
                                    <p className="text-xl font-serif text-slate-700 italic mt-1">
                                        {config.showGenderHint ? currentQ.noun : currentQ.noun.replace(/\([mfn]\)/g, '')}
                                    </p>
                                </div>

                                {/* Texto Interactivo */}
                                <TextRenderer />

                                {/* √Årea de Opciones */}
                                {!feedback && !isFinished && activeSlot && (
                                    <div className="w-full max-w-md slide-up">
                                        <p className="text-center text-xs font-bold text-blue-500 uppercase mb-4">
                                            {activeSlot.type === 'art' ? T.selectArt : T.selectAdj}
                                        </p>
                                        <div className="grid grid-cols-2 gap-3">
                                            {activeSlot.options.map(opt => (
                                                <button
                                                    key={opt}
                                                    onClick={() => handleSlotClick(activeSlotIndex, opt)}
                                                    className="py-4 rounded-xl border-2 border-slate-100 hover:border-blue-400 hover:bg-blue-50 text-slate-700 font-bold text-lg transition-all"
                                                >
                                                    {opt}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Bot√≥n Comprobar */}
                                {!feedback && isFinished && (
                                    <div className="w-full max-w-md slide-up">
                                        <button 
                                            onClick={checkAnswer}
                                            className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold text-xl shadow-lg transition-transform hover:scale-[1.02]"
                                        >
                                            {T.check}
                                        </button>
                                    </div>
                                )}

                                {/* Feedback */}
                                {feedback && (
                                    <div className="w-full max-w-md mt-6 fade-in bg-slate-50 p-6 rounded-xl border border-slate-200">
                                        <div className="flex items-center gap-3 mb-3">
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white ${feedback === 'correct' ? 'bg-green-500' : 'bg-red-500'}`}>
                                                <i className={`fas ${feedback === 'correct' ? 'fa-check' : 'fa-times'}`}></i>
                                            </div>
                                            <div>
                                                <h3 className={`font-bold text-lg ${feedback === 'correct' ? 'text-green-800' : 'text-red-800'}`}>
                                                    {feedback === 'correct' ? T.excellent : T.wrong}
                                                </h3>
                                                {feedback === 'incorrect' && (
                                                    <p className="text-sm font-bold text-red-600 mt-1">
                                                        {T.correctAnswer} <span className="underline">{currentQ.slots.map(s => s.answer).join(' ')}</span>
                                                    </p>
                                                )}
                                            </div>
                                        </div>
                                        <p className="text-slate-600 text-sm leading-relaxed mb-4 pl-11">
                                            {currentQ.explanation[lang]}
                                        </p>
                                        <button 
                                            onClick={handleNextButton}
                                            className="w-full py-3 bg-slate-900 text-white rounded-lg font-bold hover:bg-slate-800 transition-colors"
                                        >
                                            {T.next}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        <p className="text-slate-400 text-xs mt-6 text-center max-w-xs">
                            {T.tip}
                        </p>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
